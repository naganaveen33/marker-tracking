<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #startButton {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 999;
        padding: 20px 40px;
        font-size: 18px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }
      #startButton:hover {
        background: #45a049;
      }
      .hidden { display: none; }
    </style>
  </head>
  <body>
    <button id="startButton">Start AR Experience</button>
    
    <a-scene 
      embedded 
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; patternRatio: 0.90;" 
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;">
      
      <a-assets>
        <video
          id="video"
          src="https://raw.githubusercontent.com/naganaveen33/marker-tracking/main/assets/videos/lv_0_20250111230939%20(1).mp4"
          preload="auto"
          crossorigin="anonymous"
          playsinline
          webkit-playsinline
        ></video>
        <img
          id="thumbnail"
          src="https://raw.githubusercontent.com/naganaveen33/marker-tracking/main/assets/images/background.JPG"
          crossorigin="anonymous"
        />
      </a-assets>
      
      <a-marker
        type="pattern"
        url="https://raw.githubusercontent.com/naganaveen33/marker-tracking/main/assets/models/pattern-new%20logo.patt"
        id="marker"
        emitevents="true"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
      >
        <a-video
          id="arVideo"
          src="#video"
          width="1.8"
          height="3.2"
          position="0 0 0"
          rotation="-90 0 0"
          visible="false"
        ></a-video>
        
        <a-image
          id="thumbnailImg"
          src="#thumbnail"
          width="1.8"
          height="3.2"
          position="0 0 0"
          rotation="-90 0 0"
          visible="true"
        ></a-image>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      let started = false;
      const startButton = document.getElementById('startButton');
      const video = document.getElementById('video');
      const arVideo = document.getElementById('arVideo');
      const thumbnailImg = document.getElementById('thumbnailImg');
      const marker = document.getElementById('marker');

      // Start AR experience
      startButton.addEventListener('click', async () => {
        startButton.classList.add('hidden');
        started = true;
        
        // Try to load and prepare video
        try {
          await video.load();
          console.log('Video loaded successfully');
        } catch (error) {
          console.error('Error loading video:', error);
        }
      });

      // Marker found - show thumbnail
      marker.addEventListener('markerFound', () => {
        console.log('Marker found!');
        thumbnailImg.setAttribute('visible', 'true');
      });

      // Marker lost - stop video
      marker.addEventListener('markerLost', () => {
        console.log('Marker lost!');
        if (video.paused === false) {
          video.pause();
          thumbnailImg.setAttribute('visible', 'true');
          arVideo.setAttribute('visible', 'false');
        }
      });

      // Click to play video when marker is visible
      document.addEventListener('click', () => {
        if (started && thumbnailImg.getAttribute('visible') === 'true') {
          thumbnailImg.setAttribute('visible', 'false');
          arVideo.setAttribute('visible', 'true');
          
          video.play().catch(error => {
            console.error('Error playing video:', error);
            // Fallback: show thumbnail again if video fails
            thumbnailImg.setAttribute('visible', 'true');
            arVideo.setAttribute('visible', 'false');
          });
        }
      });

      // Debug: Log when video is ready
      video.addEventListener('loadeddata', () => {
        console.log('Video ready to play');
      });

      video.addEventListener('error', (e) => {
        console.error('Video error:', e);
      });
    </script>
  </body>
</html>
